(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){function t(n,t,i){var u=n.getWrapperElement(),r;return r=u.appendChild(document.createElement("div")),r.className=i?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top",typeof t=="string"?r.innerHTML=t:r.appendChild(t),r}function i(n,t){n.state.currentNotificationClose&&n.state.currentNotificationClose();n.state.currentNotificationClose=t}n.defineExtension("openDialog",function(r,u,f){function o(n){if(typeof n=="string")e.value=n;else{if(c)return;if(c=!0,s.parentNode.removeChild(s),l.focus(),f.onClose)f.onClose(s)}}var e,h;f||(f={});i(this,null);var s=t(this,r,f.bottom),c=!1,l=this;if(e=s.getElementsByTagName("input")[0],e){if(e.focus(),f.value&&(e.value=f.value,f.selectValueOnOpen!==!1&&e.select()),f.onInput)n.on(e,"input",function(n){f.onInput(n,e.value,o)});if(f.onKeyUp)n.on(e,"keyup",function(n){f.onKeyUp(n,e.value,o)});n.on(e,"keydown",function(t){f&&f.onKeyDown&&f.onKeyDown(t,e.value,o)||((t.keyCode==27||f.closeOnEnter!==!1&&t.keyCode==13)&&(e.blur(),n.e_stop(t),o()),t.keyCode==13&&u(e.value,t))});if(f.closeOnBlur!==!1)n.on(e,"blur",o)}else if(h=s.getElementsByTagName("button")[0]){n.on(h,"click",function(){o();l.focus()});if(f.closeOnBlur!==!1)n.on(h,"blur",o);h.focus()}return o});n.defineExtension("openConfirm",function(r,u,f){function v(){l||(l=!0,s.parentNode.removeChild(s),a.focus())}var e,o;i(this,null);var s=t(this,r,f&&f.bottom),h=s.getElementsByTagName("button"),l=!1,a=this,c=1;for(h[0].focus(),e=0;e<h.length;++e){o=h[e],function(t){n.on(o,"click",function(i){n.e_preventDefault(i);v();t&&t(a)})}(u[e]);n.on(o,"blur",function(){--c;setTimeout(function(){c<=0&&v()},200)});n.on(o,"focus",function(){++c})}});n.defineExtension("openNotification",function(r,u){function f(){o||(o=!0,clearTimeout(s),e.parentNode.removeChild(e))}i(this,f);var e=t(this,r,u&&u.bottom),o=!1,s,h=u&&typeof u.duration!="undefined"?u.duration:5e3;n.on(e,"click",function(t){n.e_preventDefault(t);f()});return h&&(s=setTimeout(f,h)),f})}),function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],n):n(CodeMirror)}(function(n){"use strict";function y(n,t){return typeof n=="string"?n=new RegExp(n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),t?"gi":"g"):n.global||(n=new RegExp(n.source,n.ignoreCase?"gi":"g")),{token:function(t){n.lastIndex=t.pos;var i=n.exec(t.string);if(i&&i.index==t.pos)return t.pos+=i[0].length||1,"searching";i?t.pos=i.index:t.skipToEnd()}}}function p(){this.posFrom=this.posTo=this.lastQuery=this.query=null;this.overlay=null}function i(n){return n.state.search||(n.state.search=new p)}function f(n){return typeof n=="string"&&n==n.toLowerCase()}function r(n,t,i){return n.getSearchCursor(t,i,{caseFold:f(t),multiline:!0})}function w(n,t,i,r,f){n.openDialog(t,r,{value:i,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){u(n)},onKeyDown:f})}function s(n,t,i,r,u){n.openDialog?n.openDialog(t,u,{value:r,selectValueOnOpen:!0}):u(prompt(i,r))}function b(n,t,i,r){n.openConfirm?n.openConfirm(t,r):confirm(i)&&r[0]()}function h(n){return n.replace(/\\(.)/g,function(n,t){return t=="n"?"\n":t=="r"?"\r":t})}function c(n){var t=n.match(/^\/(.*)\/([a-z]*)$/);if(t)try{n=new RegExp(t[1],t[2].indexOf("i")==-1?"":"i")}catch(i){}else n=h(n);return(typeof n=="string"?n=="":n.test(""))&&(n=/x^/),n}function e(n,t,i){t.queryText=i;t.query=c(i);n.removeOverlay(t.overlay,f(t.query));t.overlay=y(t.query,f(t.query));n.addOverlay(t.overlay);n.showMatchesOnScrollbar&&(t.annotate&&(t.annotate.clear(),t.annotate=null),t.annotate=n.showMatchesOnScrollbar(t.query,f(t.query)))}function t(t,r,u,f){var h=i(t),c,a,v;if(h.query)return o(t,r);c=t.getSelection()||h.lastQuery;u&&t.openDialog?(a=null,v=function(i,r){(n.e_stop(r),i)&&(i!=h.queryText&&(e(t,h,i),h.posFrom=h.posTo=t.getCursor()),a&&(a.style.opacity=1),o(t,r.shiftKey,function(n,i){var r;i.line<3&&document.querySelector&&(r=t.display.wrapper.querySelector(".CodeMirror-dialog"))&&r.getBoundingClientRect().bottom-4>t.cursorCoords(i,"window").top&&((a=r).style.opacity=.4)}))},w(t,l,c,v,function(r,u){var o=n.keyName(r),f=n.keyMap[t.getOption("keyMap")][o];f||(f=t.getOption("extraKeys")[o]);f=="findNext"||f=="findPrev"||f=="findPersistentNext"||f=="findPersistentPrev"?(n.e_stop(r),e(t,i(t),u),t.execCommand(f)):(f=="find"||f=="findPersistent")&&(n.e_stop(r),v(u,r))}),f&&c&&(e(t,h,c),o(t,r))):s(t,l,"Search for:",c,function(n){n&&!h.query&&t.operation(function(){e(t,h,n);h.posFrom=h.posTo=t.getCursor();o(t,r)})})}function o(t,u,f){t.operation(function(){var o=i(t),e=r(t,o.query,u?o.posFrom:o.posTo);(e.find(u)||(e=r(t,o.query,u?n.Pos(t.lastLine()):n.Pos(t.firstLine(),0)),e.find(u)))&&(t.setSelection(e.from(),e.to()),t.scrollIntoView({from:e.from(),to:e.to()},20),o.posFrom=e.from(),o.posTo=e.to(),f&&f(e.from(),e.to()))})}function u(n){n.operation(function(){var t=i(n);(t.lastQuery=t.query,t.query)&&(t.query=t.queryText=null,n.removeOverlay(t.overlay),t.annotate&&(t.annotate.clear(),t.annotate=null))})}function a(n,t,i){n.operation(function(){for(var f,u=r(n,t);u.findNext();)typeof t!="string"?(f=n.getRange(u.from(),u.to()).match(t),u.replace(i.replace(/\$(\d)/g,function(n,t){return f[t]}))):u.replace(i)})}function v(n,t){if(!n.getOption("readOnly")){var e=n.getSelection()||i(n).lastQuery,f='<span class="CodeMirror-search-label">'+(t?"Replace all:":"Replace:")+"<\/span>";s(n,f+k,f,e,function(i){i&&(i=c(i),s(n,d,"Replace with:","",function(f){if(f=h(f),t)a(n,i,f);else{u(n);var e=r(n,i,n.getCursor("from")),o=function(){var t=e.from(),u;((u=e.findNext())||(e=r(n,i),(u=e.findNext())&&(!t||e.from().line!=t.line||e.from().ch!=t.ch)))&&(n.setSelection(e.from(),e.to()),n.scrollIntoView({from:e.from(),to:e.to()}),b(n,g,"Replace?",[function(){s(u)},o,function(){a(n,i,f)}]))},s=function(n){e.replace(typeof i=="string"?f:f.replace(/\$(\d)/g,function(t,i){return n[i]}));o()};o()}}))})}}var l='<span class="CodeMirror-search-label">Search:<\/span> <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)<\/span>',k=' <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)<\/span>',d='<span class="CodeMirror-search-label">With:<\/span> <input type="text" style="width: 10em" class="CodeMirror-search-field"/>',g='<span class="CodeMirror-search-label">Replace?<\/span> <button>Yes<\/button> <button>No<\/button> <button>All<\/button> <button>Stop<\/button>';n.commands.find=function(n){u(n);t(n)};n.commands.findPersistent=function(n){u(n);t(n,!1,!0)};n.commands.findPersistentNext=function(n){t(n,!1,!0,!0)};n.commands.findPersistentPrev=function(n){t(n,!0,!0,!0)};n.commands.findNext=t;n.commands.findPrev=function(n){t(n,!0)};n.commands.clearSearch=u;n.commands.replace=v;n.commands.replaceAll=function(n){v(n,!0)}}),function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)}(function(n){"use strict";function h(n){var t=n.flags;return t!=null?t:(n.ignoreCase?"i":"")+(n.global?"g":"")+(n.multiline?"m":"")}function r(n){return n.global?n:new RegExp(n.source,h(n)+"g")}function c(n){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(n.source)}function o(n,i,u){var s,f;i=r(i);for(var e=u.line,o=u.ch,h=n.lastLine();e<=h;e++,o=0)if(i.lastIndex=o,s=n.getLine(e),f=i.exec(s),f)return{from:t(e,f.index),to:t(e,f.index+f[0].length),match:f}}function l(n,i,u){var f,h,l,p,a,v,e;if(!c(i))return o(n,i,u);for(i=r(i),h=1,l=u.line,p=n.lastLine();l<=p;){for(a=0;a<h;a++)v=n.getLine(l++),f=f==null?v:f+"\n"+v;if(h=h*2,i.lastIndex=u.ch,e=i.exec(f),e){var y=f.slice(0,e.index).split("\n"),s=e[0].split("\n"),w=u.line+y.length-1,b=y[y.length-1].length;return{from:t(w,b),to:t(w+s.length-1,s.length==1?b+s[0].length:s[s.length-1].length),match:e}}}}function s(n,t){for(var r=0,i,u;;)if((t.lastIndex=r,u=t.exec(n),!u)||(i=u,r=i.index+(i[0].length||1),r==n.length))return i}function a(n,i,u){var o,f;i=r(i);for(var e=u.line,h=u.ch,c=n.firstLine();e>=c;e--,h=-1)if(o=n.getLine(e),h>-1&&(o=o.slice(0,h)),f=s(o,i),f)return{from:t(e,f.index),to:t(e,f.index+f[0].length),match:f}}function v(n,i,u){var f,c,h,y,l,a,e;for(i=r(i),c=1,h=u.line,y=n.firstLine();h>=y;){for(l=0;l<c;l++)a=n.getLine(h--),f=f==null?a.slice(0,u.ch):a+"\n"+f;if(c*=2,e=s(f,i),e){var v=f.slice(0,e.index).split("\n"),o=e[0].split("\n"),p=h+v.length,w=v[v.length-1].length;return{from:t(p,w),to:t(p+o.length-1,o.length==1?w+o[0].length:o[o.length-1].length),match:e}}}}function i(n,t,i){var r,u;if(n.length==t.length)return i;for(r=Math.min(i,n.length);;)if(u=n.slice(0,r).toLowerCase().length,u<i)++r;else if(u>i)--r;else return r}function y(n,r,e,o){var v,s,a,c,y,e,w,p;if(!r.length)return null;v=o?u:f;s=v(r).split(/\r|\n\r?/);n:for(var h=e.line,l=e.ch,d=n.lastLine()+1-s.length;h<=d;h++,l=0){if(a=n.getLine(h).slice(l),c=v(a),s.length==1){if(y=c.indexOf(s[0]),y==-1)continue n;return e=i(a,c,y)+l,{from:t(h,i(a,c,y)+l),to:t(h,i(a,c,y+s[0].length)+l)}}if(w=c.length-s[0].length,c.slice(w)==s[0]){for(p=1;p<s.length-1;p++)if(v(n.getLine(h+p))!=s[p])continue n;var b=n.getLine(h+s.length-1),g=v(b),k=s[s.length-1];if(b.slice(0,k.length)==k)return{from:t(h,i(a,c,w)+l),to:t(h+s.length-1,i(b,g,k.length))}}}}function p(n,r,e,o){var a,s,c,l,y,p,v,e,w,b;if(!r.length)return null;a=o?u:f;s=a(r).split(/\r|\n\r?/);n:for(var h=e.line,k=e.ch,d=n.firstLine()-1+s.length;h>=d;h--,k=-1){if(c=n.getLine(h),k>-1&&(c=c.slice(0,k)),l=a(c),s.length==1){if(y=l.lastIndexOf(s[0]),y==-1)continue n;return{from:t(h,i(c,l,y)),to:t(h,i(c,l,y+s[0].length))}}if(p=s[s.length-1],l.slice(0,p.length)==p){for(v=1,e=h-s.length+1;v<s.length-1;v++)if(a(n.getLine(e+v))!=s[v])continue n;if(w=n.getLine(h+1-s.length),b=a(w),b.slice(b.length-s[0].length)==s[0])return{from:t(h+1-s.length,i(w,b,w.length-s[0].length)),to:t(h,i(c,l,p.length))}}}}function e(n,i,u,f){this.atOccurrence=!1;this.doc=n;u=u?n.clipPos(u):t(0,0);this.pos={from:u,to:u};var e;typeof f=="object"?e=f.caseFold:(e=f,f=null);typeof i=="string"?(e==null&&(e=!1),this.matches=function(t,r){return(t?p:y)(n,i,r,e)}):(i=r(i),this.matches=f&&f.multiline===!1?function(t,r){return(t?a:o)(n,i,r)}:function(t,r){return(t?v:l)(n,i,r)})}var t=n.Pos,u,f;String.prototype.normalize?(u=function(n){return n.normalize("NFD").toLowerCase()},f=function(n){return n.normalize("NFD")}):(u=function(n){return n.toLowerCase()},f=function(n){return n});e.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(i){for(var r=this.matches(i,this.doc.clipPos(i?this.pos.from:this.pos.to)),u;r&&n.cmpPos(r.from,r.to)==0;)i?r.from.ch?r.from=t(r.from.line,r.from.ch-1):r=r.from.line==this.doc.firstLine()?null:this.matches(i,this.doc.clipPos(t(r.from.line-1))):r.to.ch<this.doc.getLine(r.to.line).length?r.to=t(r.to.line,r.to.ch+1):r=r.to.line==this.doc.lastLine()?null:this.matches(i,t(r.to.line+1,0));return r?(this.pos=r,this.atOccurrence=!0,this.pos.match||!0):(u=t(i?this.doc.firstLine():this.doc.lastLine()+1,0),this.pos={from:u,to:u},this.atOccurrence=!1)},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(i,r){if(this.atOccurrence){var u=n.splitLines(i);this.doc.replaceRange(u,this.pos.from,this.pos.to,r);this.pos.to=t(this.pos.from.line+u.length-1,u[u.length-1].length+(u.length==1?this.pos.from.ch:0))}}};n.defineExtension("getSearchCursor",function(n,t,i){return new e(this.doc,n,t,i)});n.defineDocExtension("getSearchCursor",function(n,t,i){return new e(this,n,t,i)});n.defineExtension("selectMatches",function(t,i){for(var u=[],r=this.getSearchCursor(t,this.getCursor("from"),i);r.findNext();){if(n.cmpPos(r.to(),this.getCursor("to"))>0)break;u.push({anchor:r.from(),head:r.to()})}u.length&&this.setSelections(u,0)})})