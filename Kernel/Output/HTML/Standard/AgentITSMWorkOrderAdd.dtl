# --
# AgentITSMWorkOrderAdd.dtl - provides HTML form for AgentITSMWorkOrderAdd
# Copyright (C) 2001-2010 OTRS AG, http://otrs.org/
# --
# $Id: AgentITSMWorkOrderAdd.dtl,v 1.54 2010-07-08 09:30:31 ub Exp $
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file COPYING for license information (AGPL). If you
# did not receive this file, see http://www.gnu.org/licenses/agpl.txt.
# --

<script type="text/javascript" src="$Config{"Frontend::JavaScriptPath"}itsm-changemanagement.js"></script>
<script type="text/javascript">
<!--

function submit_template() {

    // check the planned time
    // 2010-01-32 is rejected, but 2010-02-31 is allowed
    // an exact time check is performed on the serverside
    if ( !CheckTime( 'MoveTime' ) ) {
        alert('$JSText{"The planned time is invalid!"}');

        return false;
    }

    return true;
}

function submit_compose() {

    // check the title, all whitespace counts as empty
    if (document.compose.WorkOrderTitle.value.match(/^\s*$/)) {
        alert('$JSText{"A workorder must have a title!"}');
        document.compose.WorkOrderTitle.focus();

        return false;
    }

    // check the planned start time
    if ( !CheckTime( 'PlannedStartTime' ) ) {
        alert('$JSText{"The planned start time is invalid!"}');

        return false;
    }

    // check the planned end time
    if ( !CheckTime( 'PlannedEndTime' ) ) {
        alert('$JSText{"The planned end time is invalid!"}');

        return false;
    }

    // check whether the planned start time is before the planned end time
    var StartAfterEndMsg = '$JSText{"The planned start time must be before the planned end time!"}';
    if ( !CheckStartBeforeEnd( 'PlannedStartTime', 'PlannedEndTime', StartAfterEndMsg ) ) {
        return false;
    }

<!-- dtl:block:WorkOrderFreeTextCheckJs -->
    // check the required freetext fields
    if (document.compose.$Data{"WorkOrderFreeTextField"}.value == "") {
        alert('$JSText{"A required field is:"} ' + document.compose.$Data{"WorkOrderFreeKeyField"}.value + '!');
        document.compose.$Data{"WorkOrderFreeTextField"}.focus();

        return false;
    }
<!-- dtl:block:WorkOrderFreeTextCheckJs -->

    return true;
}
//-->
</script>

<table border="0" width="100%" cellspacing="0" cellpadding="3">
    <tr>
        <td class="mainhead">
            <div title="$Env{"Box0"} $Text{"Add Workorder to"} $Config{"ITSMChange::Hook"}: $QData{"ChangeNumber"} $Env{"Box1"} $QData{"ChangeTitle"}">
                $Env{"Box0"} $Text{"Add Workorder to"} $Config{"ITSMChange::Hook"}: $QData{"ChangeNumber"} $Env{"Box1"} $QData{"ChangeTitle","70"}
            </div>
        </td>
    </tr>
    <tr>
        <td class="menu">
            <a href="$Env{"Baselink"}$Env{"LastChangeView"}" onmouseover="window.status='$JSText{"Back"}'; return true;" onmouseout="window.status='';" class="menuitem">$Text{"Back"}</a>
        </td>
    </tr>

<!-- dtl:block:WorkOrderTemplate -->
    <tr>
        <td class="mainbody">
            <br/>
            <form action="$Env{"CGIHandle"}" method="post" name="template">
                <input type="hidden" name="Action"    value="$Env{"Action"}">
                <input type="hidden" name="Subaction" value="CreateFromTemplate">
                <input type="hidden" name="ChangeID"  value="$QData{"ChangeID"}">
                <table border="0" width="800" align="center" cellspacing="0" cellpadding="4">
                    <tr>
                        <td class="contenthead">$Text{"Select Workorder Template"}</td>
                    </tr>
                    <tr class="contentbody">
                        <td>
                            <table border="0">
                                <tr>
                                    <td class="contentkey">
                                        $Text{"Template"}:
                                        <font color="red" title="$Text{"Required"}">*</font>
                                    </td>
                                    <td class="contentvalue">
                                        $Data{"TemplateSelectionString"}
<!-- dtl:block:InvalidTemplate -->
                                        <br />
                                        <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidTemplate -->
                                    </td>
                                </tr>
                                <tr>
                                    <td class="contentkey">$Text{"Time type"}:</td>
                                    <td class="contentvalue">
                                        $Data{"MoveTimeTypeSelectionString"}
<!-- dtl:block:InvalidMoveTimeType -->
                                        <br />
                                        <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidMoveTimeType -->
                                    </td>
                                </tr>
                                <tr>
                                    <td class="contentkey">$Text{"New time"}:</td>
                                    <td class="contentvalue">
                                        $Data{"MoveTimeSelectionString"}
<!-- dtl:block:InvalidMoveTime -->
                                        <br />
                                        <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidMoveTime -->
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td class="contentfooter">
                            <input class="button" id="submitTemplate" accesskey="t" type="submit" name="SubmitTemplate" value="$Text{"Create"}" onclick="return submit_template();"/>
                        </td>
                    </tr>
                </table>
            </form>
            <br>
        </td>
    </tr>
<!-- dtl:block:WorkOrderTemplate -->

    <tr>
        <td class="mainbody">
            <br>
            <form action="$Env{"CGIHandle"}" method="post" enctype="multipart/form-data" name="compose">
                <input type="hidden" name="Action"    value="$Env{"Action"}">
                <input type="hidden" name="Subaction" value="Save">
                <input type="hidden" name="ChangeID"  value="$QData{"ChangeID"}">
                <input type="hidden" name="FormID"    value="$QData{"FormID"}">
                <table border="0" width="800" align="center" cellspacing="0" cellpadding="4">
                    <tr>
                        <td class="contenthead">$Text{"Workorder"}</td>
                    </tr>
                    <tr class="contentbody">
                        <td>
                            <table border="0">
                                <tr>
                                    <td class="contentkey">
                                        $Text{"Title"}:
                                        <font color="red" title="$Text{"Required"}">*</font>
                                    </td>
                                    <td class="contentvalue">
                                        <input type="text" name="WorkOrderTitle" value="$QData{"WorkOrderTitle"}" size="70" maxlength="250">
<!-- dtl:block:InvalidTitle -->
                                        <br />
                                        <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidTitle -->
                                    </td>
                                </tr>
                                <tr>
                                    <td class="contentkey">
                                        $Text{"Instruction"}:
                                    </td>
                                    <td class="contentvalue">
                                        <div>
<!-- dtl:block:RichText -->
$Include{"RichTextEditorITSM"}
<!-- dtl:block:RichText -->
                                            <textarea id="RichText1" name="Instruction" rows="15" cols="$Config{"ITSM::Frontend::TextArea"}" wrap="$Env{"BrowserWrap"}">$Data{"Instruction"}</textarea>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">&nbsp;</td>
                                </tr>
                                <tr>
                                    <td class="contentkey">
                                        $Text{"WorkOrderType"}:
                                    </td>
                                    <td class="contentvalue">
<!-- dtl:block:WorkOrderType -->
                                        $Data{"TypeStrg"}
<!-- dtl:block:WorkOrderType -->
<!-- dtl:block:InvalidType -->
                                        <br />
                                        <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidType -->
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">&nbsp;</td>
                                </tr>
<!-- dtl:block:WorkOrderFreeText -->
                                <tr>
                                    <td class="contentkey">$Data{"WorkOrderFreeKeyField"}:</td>
                                    <td class="contentvalue">
                                        $Data{"WorkOrderFreeTextField"}
<!-- dtl:block:InvalidWorkOrderFreeText -->
                                        <br />
                                        <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidWorkOrderFreeText -->
                                    </td>
                                </tr>
<!-- dtl:block:WorkOrderFreeText -->
<!-- dtl:block:WorkOrderFreeTextSpacer -->
                                <tr>
                                    <td colspan="2">&nbsp;</td>
                                </tr>
<!-- dtl:block:WorkOrderFreeTextSpacer -->
# #############################################################
# example for customization of single workorder freetext fields
# #############################################################
#<!-- dtl:block:WorkOrderFreeText1 -->
#                                <tr>
#                                  <td class="contentkey">$Data{"WorkOrderFreeKeyField1"}:</td>
#                                   <td class="contentvalue">
#                                       $Data{"WorkOrderFreeTextField1"}
#<!-- dtl:block:InvalidWorkOrderFreeText1 -->
#                                       <br />
#                                       <font color="red" size="-2">$Text{"Input invalid"}</font>
#<!-- dtl:block:InvalidWorkOrderFreeText1 -->
#                                  </td>
#                                </tr>
#<!-- dtl:block:WorkOrderFreeText1 -->
#
#
#<!-- dtl:block:WorkOrderFreeText2 -->
#                                <tr>
#                                  <td colspan="2" class="contentkey">$Data{"WorkOrderFreeKeyField2"}:</td>
#                                  <td class="contentvalue">
#                                      $Data{"WorkOrderFreeTextField2"}
#<!-- dtl:block:InvalidWorkOrderFreeText2 -->
#                                       <br />
#                                       <font color="red" size="-2">$Text{"Input invalid"}</font>
#<!-- dtl:block:InvalidWorkOrderFreeText2 -->
#                                  </td>
#                                </tr>
#<!-- dtl:block:WorkOrderFreeText2 -->
# ####################################################
                                <tr>
                                    <td class="contentkey">
                                        $Text{"PlannedStartTime"}:
                                    </td>
                                    <td class="contentvalue">
                                        $Data{"PlannedStartTimeString"}
<!-- dtl:block:InvalidPlannedStartTime -->
                                        <br />
                                        <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidPlannedStartTime -->
                                    </td>
                                </tr>
                                <tr>
                                    <td class="contentkey">
                                        $Text{"PlannedEndTime"}:
                                    </td>
                                    <td class="contentvalue">
                                        $Data{"PlannedEndTimeString"}
<!-- dtl:block:InvalidPlannedEndTime -->
                                        <br />
                                        <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidPlannedEndTime -->
                                    </td>
                                </tr>
<!-- dtl:block:ShowPlannedEffort -->
                                <tr>
                                    <td class="contentkey">$Text{"PlannedEffort"}:</td>

                                    <td class="contentvalue">
                                        <div>
                                            <input type="text" name="PlannedEffort" value="$QData{"PlannedEffort"}" size="11" maxlength="11">
<!-- dtl:block:InvalidPlannedEffort -->
                                            <br />
                                            <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidPlannedEffort -->
                                        </div>
                                    </td>
                                </tr>
<!-- dtl:block:ShowPlannedEffort -->
                                <tr>
                                    <td colspan="2">&nbsp;</td>
                                </tr>
                                <tr>
                                    <td class="contentkey">
                                        $Text{"Attachment"}:
                                    </td>
                                    <td class="contentvalue">
                                        <table width="100%">
<!-- dtl:block:AttachmentRow -->
                                            <tr>
                                                <td>$Data{"Filename"}</td>
                                                <td width="16"><a href="$Env{"Baselink"}Action=$Env{"Action"};Subaction=DownloadAttachment;FileID=$LQData{"FileID"};FormID=$QData{"FormID"};ChangeID=$LQData{"ChangeID"}"><img src="$Config{"Frontend::ImagePath"}disk-s.png" border="0" alt="Download" title="Download"/></a></td>
                                                <td>$Data{"Filesize"}</td>
                                                <td width="100%"><input class="button" type="submit" name="DeleteAttachment$QData{"FileID"}" value="$Text{"Delete"}"></td>
                                            </tr>
<!-- dtl:block:AttachmentRow -->
                                            <tr>
                                                <td colspan="3">
                                                    <input type="file" name="AttachmentNew">
<!-- dtl:block:FileAlreadyUploaded -->
                                                    <br />
                                                    <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:FileAlreadyUploaded -->
                                                </td>
                                                <td width="100%"><input type="submit" class="button" name="SaveAttachment" value="$Text{"Attach"}"></td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td class="contentfooter">
                            <input class="button" id="submitWorkOrderAdd" accesskey="g" type="submit" name="WorkOrderAdd" value="$Text{"Save"}" onclick="return submit_compose();"/>
                        </td>
                    </tr>
                </table>
            </form>
            <br>
        </td>
    </tr>
</table>
