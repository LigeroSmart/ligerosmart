# --
# AgentITSMChangeAdd.dtl - provides HTML form for AgentITSMChangeAdd
# Copyright (C) 2001-2010 OTRS AG, http://otrs.org/
# --
# $Id: AgentITSMChangeAdd.dtl,v 1.56 2010-12-07 17:27:27 ub Exp $
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file COPYING for license information (AGPL). If you
# did not receive this file, see http://www.gnu.org/licenses/agpl.txt.
# --

$Include{"AJAX"}

<script type="text/javascript" src="$Config{"Frontend::JavaScriptPath"}itsm-changemanagement.js"></script>
<script language="JavaScript" type="text/javascript">
<!--

function submit_template() {

    // the Subaction depends on which button was clicked
    document.compose.Subaction.value = 'CreateFromTemplate';

    // check the planned time
    // 2010-01-32 is rejected, but 2010-02-31 is allowed
    // an exact time check is performed on the serverside
    if ( !CheckTime( 'MoveTime' ) ) {
        alert('$JSText{"The planned time is invalid!"}');

        return false;
    }

    return true;
}

function submit_compose() {

    // the Subaction depends on which button was clicked
    document.compose.Subaction.value = 'Save';

    // check the title, all whitespace counts as empty
    if (document.compose.ChangeTitle.value.match(/^\s*$/)) {
        alert('$JSText{"A change must have a title!"}');
        document.compose.ChangeTitle.focus();

        return false;
    }

    // check the requested time
    if ( document.compose.RequestedTimeUsed.checked && !CheckTime( 'RequestedTime' ) ) {
        alert('$JSText{"The requested time is invalid!"}');

        return false;
    }

    // check the requested time
    if ( document.compose.RequestedTimeUsed.checked && !CheckTime( 'RequestedTime' ) ) {
        alert('$JSText{"The requested time is invalid!"}');

        return false;
    }

<!-- dtl:block:ChangeFreeTextCheckJs -->
    // check the required freetext fields
    if (document.compose.$Data{"ChangeFreeTextField"}.value == "") {
        alert('$JSText{"A required field is:"} ' + document.compose.$Data{"ChangeFreeKeyField"}.value + '!');
        document.compose.$Data{"ChangeFreeTextField"}.focus();

        return false;
    }
<!-- dtl:block:ChangeFreeTextCheckJs -->

    return true;
}

//-->
</script>

<form action="$Env{"CGIHandle"}" method="post" enctype="multipart/form-data" name="compose">
    <input type="hidden" name="Action"     value="$Env{"Action"}">
    <input type="hidden" name="TicketID"   value="$QData{"TicketID"}">
    <input type="hidden" name="Subaction"  value="">
    <input type="hidden" name="FormID"     value="$QData{"FormID"}">
    <table border="0" width="100%" cellspacing="0" cellpadding="3">
        <tr>
            <td class="mainhead">
                <div title="$Env{"Box0"} $Text{"ITSM Change"}: $Text{"NEW"} $Env{"Box1"}">
                    $Env{"Box0"} $Text{"ITSM Change"}: $Text{"NEW"} $Env{"Box1"}
                </div>
            </td>
        </tr>
        <tr>
            <td class="menu">
                <a class="menuitem" href="$Env{"Baselink"}Action=AgentITSMChange" onclick="history.back(); return false;">$Text{"Back"}</a>
            </td>
        </tr>

<!-- dtl:block:ChangeTemplate -->
        <tr>
            <td class="mainbody">
                <br />
                <table border="0" width="800" align="center" cellspacing="0" cellpadding="4">
                    <tr>
                        <td class="contenthead">$Text{"Select Change Template"}</td>
                    </tr>
                    <tr class="contentbody">
                        <td>
                            <table border="0" width="100%" cellspacing="0" cellpadding="3">
                                <colgroup>
                                    <col width="130"/>
                                </colgroup>
                                <tr>
                                    <td class="contentkey">
                                        $Text{"Template"}:
                                        <font color="red" title="$Text{"Required"}">*</font>
                                    </td>
                                    <td class="contentvalue">
                                        $Data{"TemplateSelectionString"}
<!-- dtl:block:InvalidTemplate -->
                                        <br />
                                        <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidTemplate -->
                                    </td>
                                </tr>
                                <tr>
                                    <td class="contentkey">$Text{"Time type"}:</td>
                                    <td class="contentvalue">
                                        $Data{"MoveTimeTypeSelectionString"}
<!-- dtl:block:InvalidMoveTimeType -->
                                        <br />
                                        <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidMoveTimeType -->
                                    </td>
                                </tr>
                                <tr>
                                    <td class="contentkey">$Text{"New time"}:</td>
                                    <td class="contentvalue">
                                        $Data{"MoveTimeSelectionString"}
<!-- dtl:block:InvalidMoveTime -->
                                        <br />
                                        <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidMoveTime -->
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td class="contentfooter">
                            <input class="button" id="submitTemplate" accesskey="t" type="submit" name="SubmitTemplate" value="$Text{"Create"}" onclick="return submit_template();"/>
                        </td>
                    </tr>
                </table>
                <br />
            </td>
        </tr>
<!-- dtl:block:ChangeTemplate -->
        <tr>
            <td class="mainbody">
                <br />
                <table border="0" width="800" align="center" cellspacing="0" cellpadding="4">
                    <tr>
                        <td class="contenthead">$Text{"ITSM Change"}</td>
                    </tr>
                    <tr class="contentbody">
                        <td>
                            <table border="0" width="100%" cellspacing="0" cellpadding="3">
                                <colgroup>
                                    <col width="130"/>
                                </colgroup>
                                <tr>
                                    <td class="contentkey">
                                        $Text{"Title"}:
                                    </td>
                                    <td class="contentvalue">
                                        <input type="text" name="ChangeTitle" value="$QData{"ChangeTitle"}" size="70" maxlength="250">
<!-- dtl:block:InvalidTitle -->
                                        <br />
                                        <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidTitle -->
                                    </td>
                                </tr>
                                <tr>
                                    <td class="contentkey">
                                        $Text{"Description"}:
                                    </td>
                                    <td class="contentvalue">
                                        <div>
<!-- dtl:block:RichText -->
$Include{"RichTextEditorITSM"}
<!-- dtl:block:RichText -->
                                            <textarea id="RichText1" name="Description" rows="15" cols="$Config{"ITSM::Frontend::TextArea"}" wrap="$Env{"BrowserWrap"}">$Data{"Description"}</textarea>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="contentkey">
                                        $Text{"Justification"}:
                                    </td>
                                    <td class="contentvalue">
                                        <div>
                                            <textarea id="RichText2" name="Justification" rows="15" cols="$Config{"ITSM::Frontend::TextArea"}" wrap="$Env{"BrowserWrap"}">$Data{"Justification"}</textarea>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">&nbsp;</td>
                                </tr>
                                <tr>
                                    <td class="contentkey">
                                        $Text{"Category"}:
                                    </td>
                                    <td class="contentvalue">
                                        $Data{"CategorySelectionString"}
<!-- dtl:block:InvalidCategory -->
                                        <br />
                                        <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidCategory -->
                                    </td>
                                </tr>
                                <tr>
                                    <td class="contentkey">
                                        $Text{"Impact"}:
                                    </td>
                                    <td class="contentvalue">
                                        $Data{"ImpactSelectionString"}
<!-- dtl:block:InvalidImpact -->
                                        <br />
                                        <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidImpact -->
                                    </td>
                                </tr>
                                <tr>
                                    <td class="contentkey">
                                        $Text{"Priority"}:
                                    </td>
                                    <td class="contentvalue">
                                        $Data{"PrioritySelectionString"}
<!-- dtl:block:InvalidPriority -->
                                        <br />
                                        <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidPriority -->
                                    </td>
                                </tr>
<!-- dtl:block:ChangeFreeTextSpacer -->
                                <tr>
                                    <td colspan="2">&nbsp;</td>
                                </tr>
<!-- dtl:block:ChangeFreeTextSpacer -->
<!-- dtl:block:ChangeFreeText -->
                                <tr>
                                    <td class="contentkey">$Data{"ChangeFreeKeyField"}:</td>
                                    <td class="contentvalue">
                                        $Data{"ChangeFreeTextField"}
<!-- dtl:block:InvalidChangeFreeText -->
                                        <br />
                                        <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidChangeFreeText -->
                                    </td>
                                </tr>
<!-- dtl:block:ChangeFreeText -->
# ###########################################################
# example for customization of single change freetext fields
# ###########################################################
#<!-- dtl:block:ChangeFreeText1 -->
#                                <tr>
#                                  <td class="contentkey">$Data{"ChangeFreeKeyField1"}:</td>
#                                   <td class="contentvalue">
#                                       $Data{"ChangeFreeTextField1"}
#<!-- dtl:block:InvalidChangeFreeText1 -->
#                                       <br />
#                                       <font color="red" size="-2">$Text{"Input invalid"}</font>
#<!-- dtl:block:InvalidChangeFreeText1 -->
#                                  </td>
#                                </tr>
#<!-- dtl:block:ChangeFreeText1 -->
#
#
#<!-- dtl:block:ChangeFreeText2 -->
#                                <tr>
#                                  <td colspan="2" class="contentkey">$Data{"ChangeFreeKeyField2"}:</td>
#                                  <td class="contentvalue">
#                                      $Data{"ChangeFreeTextField2"}
#<!-- dtl:block:InvalidChangeFreeText2 -->
#                                       <br />
#                                       <font color="red" size="-2">$Text{"Input invalid"}</font>
#<!-- dtl:block:InvalidChangeFreeText2 -->
#                                  </td>
#                                </tr>
#<!-- dtl:block:ChangeFreeText2 -->
# ####################################################
                                <tr>
                                    <td colspan="2">&nbsp;</td>
                                </tr>
<!-- dtl:block:RequestedTime -->
                                <tr>
                                    <td class="contentkey">
                                        $Text{"Requested Date"}:
                                    </td>
                                    <td class="contentvalue">
                                        $Data{"RequestedTimeString"}
<!-- dtl:block:InvalidRequestedTime -->
                                        <br />
                                        <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:InvalidRequestedTime -->
                                    </td>
                                </tr>
<!-- dtl:block:RequestedTime -->
                                <tr>
                                    <td colspan="2">&nbsp;</td>
                                </tr>
                                <tr>
                                    <td class="contentkey">$Text{"Attachment"}:</td>
                                    <td class="contentvalue">
                                        <table width="100%" cellspacing="0" cellpadding="0">
<!-- dtl:block:AttachmentRow -->
                                            <tr>
                                                <td>$QData{"Filename"}</td>
                                                <td width="16"><a href="$Env{"Baselink"}Action=$Env{"Action"};Subaction=DownloadAttachment;FileID=$LQData{"FileID"};FormID=$LQData{"FormID"}"><img src="$Config{"Frontend::ImagePath"}disk-s.png" border="0" alt="Download" title="Download"/></a></td>
                                                <td>$QData{"Filesize"}</td>
                                                <td width="100%"><input class="button" type="submit" name="DeleteAttachment$QData{"FileID"}" value="$Text{"Delete"}"></td>
                                            </tr>
<!-- dtl:block:AttachmentRow -->
                                            <tr>
                                                <td colspan="3">
                                                    <input type="file" name="AttachmentNew">
<!-- dtl:block:FileAlreadyUploaded -->
                                                    <br />
                                                    <font color="red" size="-2">$Text{"Input invalid"}</font>
<!-- dtl:block:FileAlreadyUploaded -->
                                                </td>
                                                <td width="100%">
                                                    <input type="submit" class="button" name="SaveAttachment" value="$Text{"Attach"}">
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td class="contentfooter">
                            <input class="button" id="submitAddChange" accesskey="g" type="submit" name="AddChange" value="$Text{"Submit"}" onclick="return submit_compose();"/>
                        </td>
                    </tr>
                </table>
                <br />
            </td>
        </tr>
    </table>
</form>
